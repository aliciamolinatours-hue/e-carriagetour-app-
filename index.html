<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Registro de Viajes - Calèche</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* CSS actualizado se incluirá aquí */
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="header-main">
                    <h1><i class="fas fa-bolt"></i> Calèche</h1>
                    <div class="header-subtitle">
                        <span id="current-date"></span>
                        <span class="badge" id="trip-count">0 viajes hoy</span>
                    </div>
                </div>
            </div>
        </div>
    </header>
    
    <main class="container">
        <section class="form-section">
            <h2 class="section-title">
                <i class="fas fa-plus-circle"></i>
                <span>Nuevo Viaje</span>
            </h2>
            
            <div class="form-card">
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-users"></i>
                        <span>Pasajeros</span>
                    </label>
                    <div class="pax-buttons">
                        <button class="pax-btn" data-pax="1">1</button>
                        <button class="pax-btn" data-pax="2">2</button>
                        <button class="pax-btn" data-pax="3">3</button>
                        <button class="pax-btn" data-pax="4">4</button>
                        <button class="pax-btn" data-pax="5">5</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-globe-europe"></i>
                        <span>País</span>
                    </label>
                    <div class="country-input">
                        <input type="text" id="country" placeholder="Escribe el país...">
                        <div id="country-suggestions"></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-money-bill-wave"></i>
                        <span>Método de Pago</span>
                    </label>
                    <div class="payment-buttons">
                        <button class="payment-btn cash" data-payment="cash">
                            <i class="fas fa-money-bill"></i>
                            <span>Efectivo</span>
                        </button>
                        <button class="payment-btn card" data-payment="card">
                            <i class="fas fa-credit-card"></i>
                            <span>Tarjeta</span>
                        </button>
                    </div>
                </div>
                
                <div id="tip-section-cash" class="tip-section">
                    <label class="form-label">
                        <i class="fas fa-euro-sign"></i>
                        <span>Propina</span>
                    </label>
                    <div class="tip-buttons">
                        <button class="tip-btn" data-tip="0">0€</button>
                        <button class="tip-btn custom-tip-btn-open" data-tip="custom">
                            <i class="fas fa-edit"></i>
                            <span>Personalizar</span>
                        </button>
                    </div>
                    <div class="custom-tip" id="custom-tip-cash" style="display: none;">
                        <input type="number" id="custom-tip-input-cash" placeholder="Ej: 3.50" min="0" step="0.5">
                        <button class="custom-tip-btn" id="set-tip-cash">Aplicar</button>
                    </div>
                </div>
                
                <div id="tip-section-card" class="tip-section">
                    <label class="form-label">
                        <i class="fas fa-euro-sign"></i>
                        <span>Propina</span>
                    </label>
                    <div class="tip-buttons">
                        <button class="tip-btn" data-tip="0">0€</button>
                        <button class="tip-btn" data-tip="7">7€</button>
                        <button class="tip-btn" data-tip="10.5">10.5€</button>
                        <button class="tip-btn" data-tip="14">14€</button>
                        <button class="tip-btn custom-tip-btn-open" data-tip="custom">
                            <i class="fas fa-edit"></i>
                            <span>Personalizar</span>
                        </button>
                    </div>
                    <div class="custom-tip" id="custom-tip-card" style="display: none;">
                        <input type="number" id="custom-tip-input-card" placeholder="Ej: 5.00" min="0" step="0.5">
                        <button class="custom-tip-btn" id="set-tip-card">Aplicar</button>
                    </div>
                </div>
                
                <button id="save-trip" class="save-btn">
                    <i class="fas fa-check-circle"></i>
                    <span>Guardar Viaje</span>
                </button>
                
                <div id="confirmation-message" class="confirmation-message">
                    <i class="fas fa-check"></i>
                    <span>Viaje guardado</span>
                </div>
            </div>
        </section>
        
        <section class="trips-section">
            <h2 class="section-title">
                <i class="fas fa-history"></i>
                <span>Viajes de Hoy</span>
            </h2>
            
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-value" id="total-trips">0</div>
                    <div class="stat-label">Total</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="total-pax">0</div>
                    <div class="stat-label">Pasajeros</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="total-tips">0€</div>
                    <div class="stat-label">Propinas</div>
                </div>
            </div>
            
            <div class="trip-list">
                <div id="trips-container">
                    <div class="empty-list" id="empty-list-message">
                        <i class="fas fa-car"></i>
                        <p>No hay viajes registrados hoy</p>
                        <small>Registra tu primer viaje arriba</small>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <footer>
        <div class="container">
            <p>Registro de viajes • Calèche</p>
            <small>Datos guardados localmente en tu dispositivo</small>
        </div>
    </footer>

    <script>
        // Datos iniciales
        let trips = JSON.parse(localStorage.getItem('taxiTrips')) || [];
        let selectedPax = null;
        let selectedPayment = null;
        let selectedTip = 0;
        let currentPaymentType = null;
        
        // Lista de países para autocompletar - 195 países de la ONU ordenados alfabéticamente
const countries = [
    "Afganistán", "Albania", "Alemania", "Andorra", "Angola", "Antigua y Barbuda",
    "Arabia Saudita", "Argelia", "Argentina", "Armenia", "Australia", "Austria",
    "Azerbaiyán", "Bahamas", "Bangladés", "Barbados", "Baréin", "Bélgica",
    "Belice", "Benín", "Bielorrusia", "Birmania (Myanmar)", "Bolivia",
    "Bosnia y Herzegovina", "Botsuana", "Brasil", "Brunéi", "Bulgaria",
    "Burkina Faso", "Burundi", "Bután", "Cabo Verde", "Camboya", "Camerún",
    "Canadá", "Catar", "Chad", "Chile", "China", "Chipre", "Colombia",
    "Comoras", "Corea del Norte", "Corea del Sur", "Costa de Marfil",
    "Costa Rica", "Croacia", "Cuba", "Dinamarca", "Dominica", "Ecuador",
    "Egipto", "El Salvador", "Emiratos Árabes Unidos", "Eritrea", "Eslovaquia",
    "Eslovenia", "España", "Estados Unidos", "Estonia", "Esuatini", "Etiopía",
    "Filipinas", "Finlandia", "Fiyi", "Francia", "Gabón", "Gambia", "Georgia",
    "Ghana", "Granada", "Grecia", "Guatemala", "Guinea", "Guinea Ecuatorial",
    "Guinea-Bisáu", "Guyana", "Haití", "Honduras", "Hungría", "India",
    "Indonesia", "Irak", "Irán", "Irlanda", "Islandia", "Islas Marshall",
    "Islas Salomón", "Israel", "Italia", "Jamaica", "Japón", "Jordania",
    "Kazajistán", "Kenia", "Kirguistán", "Kiribati", "Kuwait", "Laos",
    "Lesoto", "Letonia", "Líbano", "Liberia", "Libia", "Liechtenstein",
    "Lituania", "Luxemburgo", "Macedonia del Norte", "Madagascar", "Malasia",
    "Malaui", "Maldivas", "Malí", "Malta", "Marruecos", "Mauricio", "Mauritania",
    "México", "Micronesia", "Moldavia", "Mónaco", "Mongolia", "Montenegro",
    "Mozambique", "Namibia", "Nauru", "Nepal", "Nicaragua", "Níger", "Nigeria",
    "Noruega", "Nueva Zelanda", "Omán", "Países Bajos", "Pakistán", "Palaos",
    "Palestina", "Panamá", "Papúa Nueva Guinea", "Paraguay", "Perú", "Polonia",
    "Portugal", "Reino Unido", "República Centroafricana", "República Checa",
    "República del Congo", "República Democrática del Congo", "República Dominicana",
    "Ruanda", "Rumanía", "Rusia", "Samoa", "San Cristóbal y Nieves", "San Marino",
    "San Vicente y las Granadinas", "Santa Lucía", "Santo Tomé y Príncipe",
    "Senegal", "Serbia", "Seychelles", "Sierra Leona", "Singapur", "Siria",
    "Somalia", "Sri Lanka", "Sudáfrica", "Sudán", "Sudán del Sur", "Suecia",
    "Suiza", "Surinam", "Tailandia", "Tanzania", "Tayikistán", "Timor Oriental",
    "Togo", "Tonga", "Trinidad y Tobago", "Túnez", "Turkmenistán", "Turquía",
    "Tuvalu", "Ucrania", "Uganda", "Uruguay", "Uzbekistán", "Vanuatu",
    "Vaticano (Santa Sede)", "Venezuela", "Vietnam", "Yemen", "Yibuti",
    "Zambia", "Zimbabue"
];
        
        // Inicializar aplicación
        document.addEventListener('DOMContentLoaded', function() {
            updateCurrentDate();
            loadTrips();
            updateStats();
            setupEventListeners();
            setupCountryAutocomplete();
        });
        
        function updateCurrentDate() {
            const now = new Date();
            const options = { weekday: 'short', day: 'numeric', month: 'short' };
            document.getElementById('current-date').textContent = now.toLocaleDateString('es-ES', options);
        }
        
        function setupEventListeners() {
            // Botones de pasajeros
            document.querySelectorAll('.pax-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.pax-btn').forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedPax = parseInt(this.getAttribute('data-pax'));
                });
            });
            
            // Botones de pago
            document.querySelectorAll('.payment-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.payment-btn').forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedPayment = this.getAttribute('data-payment');
                    currentPaymentType = selectedPayment;
                    
                    // Mostrar sección de propinas
                    document.querySelectorAll('.tip-section').forEach(section => {
                        section.style.display = 'none';
                    });
                    
                    if (selectedPayment === 'cash') {
                        document.getElementById('tip-section-cash').style.display = 'block';
                        selectedTip = 0;
                    } else if (selectedPayment === 'card') {
                        document.getElementById('tip-section-card').style.display = 'block';
                        selectedTip = 0;
                    }
                    
                    document.querySelectorAll('.tip-btn').forEach(b => b.classList.remove('selected'));
                    document.getElementById('custom-tip-cash').style.display = 'none';
                    document.getElementById('custom-tip-card').style.display = 'none';
                });
            });
            
            // Botones de propina
            document.querySelectorAll('.tip-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tipValue = this.getAttribute('data-tip');
                    
                    if (tipValue === 'custom') {
                        if (currentPaymentType === 'cash') {
                            document.getElementById('custom-tip-cash').style.display = 'flex';
                        } else if (currentPaymentType === 'card') {
                            document.getElementById('custom-tip-card').style.display = 'flex';
                        }
                    } else {
                        document.getElementById('custom-tip-cash').style.display = 'none';
                        document.getElementById('custom-tip-card').style.display = 'none';
                        document.querySelectorAll('.tip-btn').forEach(b => b.classList.remove('selected'));
                        this.classList.add('selected');
                        selectedTip = parseFloat(tipValue);
                    }
                });
            });
            
            // Botones para aplicar propina personalizada
            document.getElementById('set-tip-cash').addEventListener('click', function() {
                const customTipInput = document.getElementById('custom-tip-input-cash');
                const tipValue = parseFloat(customTipInput.value);
                
                if (!isNaN(tipValue) && tipValue >= 0) {
                    selectedTip = tipValue;
                    document.querySelectorAll('.tip-btn').forEach(b => b.classList.remove('selected'));
                    
                    const confirmation = document.getElementById('confirmation-message');
                    confirmation.innerHTML = `<i class="fas fa-check"></i><span>Propina: ${tipValue.toFixed(2)}€</span>`;
                    confirmation.style.display = 'flex';
                    
                    setTimeout(() => {
                        confirmation.style.display = 'none';
                    }, 2000);
                }
            });
            
            document.getElementById('set-tip-card').addEventListener('click', function() {
                const customTipInput = document.getElementById('custom-tip-input-card');
                const tipValue = parseFloat(customTipInput.value);
                
                if (!isNaN(tipValue) && tipValue >= 0) {
                    selectedTip = tipValue;
                    document.querySelectorAll('.tip-btn').forEach(b => b.classList.remove('selected'));
                    
                    const confirmation = document.getElementById('confirmation-message');
                    confirmation.innerHTML = `<i class="fas fa-check"></i><span>Propina: ${tipValue.toFixed(2)}€</span>`;
                    confirmation.style.display = 'flex';
                    
                    setTimeout(() => {
                        confirmation.style.display = 'none';
                    }, 2000);
                }
            });
            
            // Guardar viaje
            document.getElementById('save-trip').addEventListener('click', saveTrip);
        }
        
        function setupCountryAutocomplete() {
            const countryInput = document.getElementById('country');
            const suggestionsContainer = document.getElementById('country-suggestions');
            
            countryInput.addEventListener('input', function() {
                const input = this.value.toLowerCase();
                suggestionsContainer.innerHTML = '';
                
                if (input.length > 0) {
                    const filteredCountries = countries.filter(country => 
                        country.toLowerCase().startsWith(input)
                    );
                    
                    if (filteredCountries.length > 0) {
                        filteredCountries.forEach(country => {
                            const div = document.createElement('div');
                            div.className = 'suggestion-item';
                            div.textContent = country;
                            div.addEventListener('click', function() {
                                countryInput.value = country;
                                suggestionsContainer.style.display = 'none';
                            });
                            suggestionsContainer.appendChild(div);
                        });
                        
                        suggestionsContainer.style.display = 'block';
                    } else {
                        suggestionsContainer.style.display = 'none';
                    }
                } else {
                    suggestionsContainer.style.display = 'none';
                }
            });
            
            document.addEventListener('click', function(e) {
                if (!countryInput.contains(e.target) && !suggestionsContainer.contains(e.target)) {
                    suggestionsContainer.style.display = 'none';
                }
            });
        }
        
        function saveTrip() {
            const country = document.getElementById('country').value.trim();
            
            if (!selectedPax) {
                alert('Selecciona el número de pasajeros');
                return;
            }
            
            if (!country) {
                alert('Introduce el país');
                return;
            }
            
            if (!selectedPayment) {
                alert('Selecciona el método de pago');
                return;
            }
            
            const now = new Date();
            const trip = {
                id: Date.now(),
                time: now.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' }),
                pax: selectedPax,
                country: country,
                payment: selectedPayment,
                tip: selectedTip,
                date: now.toISOString().split('T')[0]
            };
            
            trips.push(trip);
            localStorage.setItem('taxiTrips', JSON.stringify(trips));
            
            loadTrips();
            updateStats();
            
            const confirmation = document.getElementById('confirmation-message');
            confirmation.innerHTML = `<i class="fas fa-check"></i><span>Viaje guardado</span>`;
            confirmation.style.display = 'flex';
            
            resetForm();
            
            setTimeout(() => {
                confirmation.style.display = 'none';
            }, 2000);
        }
        
        function resetForm() {
            document.querySelectorAll('.pax-btn').forEach(b => b.classList.remove('selected'));
            document.querySelectorAll('.payment-btn').forEach(b => b.classList.remove('selected'));
            document.querySelectorAll('.tip-btn').forEach(b => b.classList.remove('selected'));
            document.getElementById('country').value = '';
            document.querySelectorAll('.tip-section').forEach(s => s.style.display = 'none');
            document.getElementById('custom-tip-cash').style.display = 'none';
            document.getElementById('custom-tip-card').style.display = 'none';
            document.getElementById('custom-tip-input-cash').value = '';
            document.getElementById('custom-tip-input-card').value = '';
            
            selectedPax = null;
            selectedPayment = null;
            selectedTip = 0;
            currentPaymentType = null;
        }
        
        function loadTrips() {
            const tripsContainer = document.getElementById('trips-container');
            const emptyListMessage = document.getElementById('empty-list-message');
            
            const today = new Date().toISOString().split('T')[0];
            const todayTrips = trips.filter(trip => trip.date === today);
            
            document.getElementById('trip-count').textContent = `${todayTrips.length} viajes hoy`;
            
            if (todayTrips.length === 0) {
                tripsContainer.innerHTML = '';
                tripsContainer.appendChild(emptyListMessage);
                emptyListMessage.style.display = 'flex';
                return;
            }
            
            emptyListMessage.style.display = 'none';
            
            const tripsHTML = todayTrips
                .sort((a, b) => b.id - a.id)
                .map(trip => `
                <div class="trip-item">
                    <div class="trip-time">${trip.time}</div>
                    <div class="trip-pax">${trip.pax}</div>
                    <div class="trip-country">${trip.country}</div>
                    <div class="trip-payment ${trip.payment}">
                        <i class="fas ${trip.payment === 'cash' ? 'fa-money-bill' : 'fa-credit-card'}"></i>
                    </div>
                    <div class="trip-tip">${trip.tip > 0 ? trip.tip.toFixed(2) + '€' : '-'}</div>
                </div>
            `).join('');
            
            tripsContainer.innerHTML = tripsHTML;
        }
        
        function updateStats() {
            const today = new Date().toISOString().split('T')[0];
            const todayTrips = trips.filter(trip => trip.date === today);
            
            const totalTrips = todayTrips.length;
            const totalPax = todayTrips.reduce((sum, trip) => sum + trip.pax, 0);
            const totalTips = todayTrips.reduce((sum, trip) => sum + trip.tip, 0);
            
            document.getElementById('total-trips').textContent = totalTrips;
            document.getElementById('total-pax').textContent = totalPax;
            document.getElementById('total-tips').textContent = totalTips.toFixed(2) + '€';
        }
    </script>
</body>
</html>
